# Puerto en el que se ejecuta el API Gateway
server:
  port: 9500
  # Si quieres habilitar HTTPS, agrega aquí la configuración SSL

logging:
  level:
    root: INFO # Nivel de log global
    org.springframework.web: INFO # Nivel de log para Spring Web
    org.springframework.cloud.gateway: INFO # Nivel de log para Spring Cloud Gateway
    org.springframework.security: DEBUG # Para debug de seguridad
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %logger{36} - %msg%n" # Formato de salida en consola

spring:
  application.name: api-gateway # Nombre de la aplicación

  # Configuración de OAuth2 Resource Server (JWT con Keycloak)
  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: http://localhost:9090/realms/videoclub
          jwk-set-uri: http://localhost:9090/realms/videoclub/protocol/openid-connect/certs

  cloud:
    gateway:
      server:
        webflux:
          globalcors:
            cors-configurations:
              "[/**]": # Configuración CORS para todos los endpoints
                allowedOrigins: "http://localhost:5173" # Origen permitido para solicitudes CORS
                allowedMethods: "*" # Métodos HTTP permitidos
                allowedHeaders: "*" # Cabeceras permitidas
                exposedHeaders: "Authorization" # Exponer header Authorization
                allowCredentials: true # Permitir credenciales (cookies, auth headers)
          routes:
            - id: catalogo # Servicio de Catálogo de Películas
              uri: http://localhost:8081 # Puerto del servicio Catálogo
              predicates:
                - Path=/api/peliculas/** # Rutas de películas
              filters:
                - StripPrefix=1 # Elimina /api del path
            - id: rating # Servicio de Rating de Películas
              uri: http://localhost:8082 # Puerto del servicio Rating
              predicates:
                - Path=/api/ratings/** # Rutas de ratings
              filters:
                - StripPrefix=1 # Elimina /api del path
            - id: keycloak # Servicio de autenticación Keycloak
              uri: http://localhost:9090 # Puerto de Keycloak
              predicates:
                - Path=/auth/**,/realms/** # Rutas de Keycloak
              filters:
                - RewritePath=/auth/(?<segment>.*), /$\{segment} # Reescribe /auth/* a /*

# Deshabilita Eureka por defecto
eureka:
  client:
    enabled: false # No registrar en Eureka
